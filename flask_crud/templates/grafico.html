{% extends 'base.html' %}
{% block titulo %}DBGraphics{% endblock %}
{% block contenido %}

{% include '_menu.html' %}
<div>
    <canvas id="myChart"></canvas>
</div>
<select onchange="someFunction()" name="rows" id="row_data">
    {% for element in datos.rows %}
        <option value="{{ element }}">{{ element }}</option>
    {% endfor %}
</select>

{% endblock %}
{% block librerias %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let myChart;
    //var myChartOtro = document.getElementById('myChart');
    var datos = JSON.parse('{{datos|tojson|safe}}');
    function someFunction(){
        var row_data = document.getElementById('row_data')
        console.log(row_data.value)
        if (row_data.value == '40-49'){
            drawGraph(1)
        }
        else if (row_data.value == '50-59'){
            drawGraph(2)
        }
        else if (row_data.value == '60-69'){
            drawGraph(3)
        }
        else if (row_data.value == '70-79'){
            drawGraph(4)
        }
        else if (row_data.value == '80-89'){
            drawGraph(5)
        }
        else if (row_data.value == '>=90'){
            drawGraph(6)
        }
        else{
            drawGraph(0)
        }
    }
    function drawGraph(index){
        const data = {
            labels: datos.header,
            datasets: [{
              label: 'My First dataset',
              backgroundColor: 'rgb(255, 99, 132)',
              borderColor: 'rgb(255, 99, 132)',
              data: datos.body[index],
            }]
          };
        
          const config = {
            type: 'bar',
            data: data,
            options: {}
          };
        if (myChart) {
            myChart.destroy();
        }
    myChart = new Chart(
        document.getElementById('myChart'),
      config
      );
    }
    
    const data = {
      labels: datos.header,
      datasets: [{
        label: 'My First dataset',
        backgroundColor: 'rgb(255, 99, 132)',
        borderColor: 'rgb(255, 99, 132)',
        data: datos.body[0],
      }]
    };
  
    const config = {
      type: 'bar',
      data: data,
      options: {}
    };
myChart = new Chart(
document.getElementById('myChart'),
config
);
</script>

{% endblock %}
